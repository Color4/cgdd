<!DOCTYPE html>
<!-- saved from url=(0014)about:internet --> 
<!-- The above is for IE: https://blogs.msdn.microsoft.com/ieinternals/2012/06/19/enhanced-protected-mode-and-local-files/-->
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>SV Boxplot test</title>
  
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css" class="ui-theme" />

  <link rel="stylesheet" type="text/css" href="gendep/static/gendep/style.css" />

  <script src="gendep/static/gendep/saveSvgAsPng.js"></script>
  
  <!-- link rel="stylesheet" type="text/css" href="style.css" /-->
   
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  <!-- OR: script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js" -->
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  

  
  <style type="text/css">
  #legend_table {
   border: 1px solid black;
   border-collapse: collapse;
   /* padding: 15px; */
   }
   /* #legend_table th td {border: 1px solid black;}*/
 
  #legend_table tr:hover {background-color: #f5f5f5}	


  .ui-tooltip {
    padding: 4px 4px;
    background: #ffff70;
	/*color: white; */
    border-radius: 10px;
    font: bold 12px "Helvetica Neue", Sans-Serif;
  }
  </style>
  
  <script type="text/javascript">

// SVG javascript libraries:
// http://svgjs.com/ for manipulating and annimations (15 kb gzipped)
// Raphael - 20kb when gzipped:
// http://dmitrybaranovskiy.github.io/raphael/
// https://github.com/DmitryBaranovskiy/raphael supports older browsers via VML (eg. IE<=8 and early Safari)

// Older plotting library for IE7, IE8: http://www.jqplot.com/index.php


// Box plot libraries: https://plot.ly/javascript/box-plots/
//   http://forum.highcharts.com/highcharts-usage/bee-swarm-t34154/


// D3 many good graphs: https://github.com/mbostock/d3/wiki/Gallery

// D3: http/ 3: Dchristophermanning.org/projects/building-cubic-hamiltonian-graphs-from-lcf-notation

// D3: Scatter plot matrix: http://bl.ocks.org/mbostock/3213173

// D3:Fisheye:  https://bost.ocks.org/mike/fisheye/

// Hive network plot:   https://bost.ocks.org/mike/hive/


// gene expression: http://sulab.org/2013/02/data-chart-plugin-beta/

// d3: Dependency wheel: http://www.redotheweb.com/DependencyWheel/

// Gene portal wiki:
// https://en.wikipedia.org/wiki/HER2/neu


// BioGPS:  http://biogps.org/#goto=genereport&id=2064
// and its plugins.


// Lots of different ToolTip libraries:  http://www.bypeople.com/jquery-tooltip/
// eg: SimpleTips: http://craigsworks.com/projects/simpletip/#
// TinyTips: https://github.com/Sweefty/tinytip


// Lightboxes: http://js-tutorial.com/category/lightbox-7
//    eg: Simple LightBox: http://js-tutorial.com/simple-lightbox-1502



/*
// example of beeswarm jitter for high charts:
$(function () {

      var jspace = 50;
      
    var data = [83.2,85.2,93.2,79.2,82.2,91.2,81.0,81.0,85.5,85.2,84.8,87.2,91.1,78.0,81.5,82.2,84.3,95];
    data = data.sort();
    var xydata = [];
    var l = undefined;
    var c = 1;
    for (var i = 0; i < data.length; i++) {
       d = data[i];
       if (Math.floor(d) !== l){
         l = Math.floor(d);
        c = 1;
      } else {
         c += 1;
      }
      m = (c % 2 == 0) ? 1 : -1;
      j = (Math.floor(c/2) * m)/jspace;
      // Don't let jitter get too big
      while(j > 1 || j < -1){
         var n = Math.floor(Math.abs(j)) + 1;
         j = (Math.floor(c/2) * m)/(jspace*n);
      }
      xydata.push([j,d]);
    }
   
    $('#container').highcharts({

            title: {text: 'Example Beeswarm Plot' },
        xAxis: {
            categories: ['% Aligned']
        },
        yAxis: {title: {text: null}},
            legend: { enabled: false },
        series: [{
            name: 'Alignment',
            type: 'scatter',
            data: xydata
        }]

    });
});
*/

  
/*
// Dynamically creating the SVG:
var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
// svg.setAttribute('style', 'border: 1px solid black');
svg.setAttribute('width', '600');
svg.setAttribute('height', '250');
svg.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");
document.body.appendChild(svg);
*/  
// For hyperlinks from SVG elements: http://stackoverflow.com/questions/20539196/creating-svg-elements-dynamically-with-javascript-inside-html

  
// edge effects: http://www.software-architects.com/devblog/2015/03/22/Shades-of-Gray-in-SVG---How-to-Get-a-Sharp-Black-Line

// A dictionary might be faster:
function histotype_display(histotype) { // This is a duplicate of the one in index.html
  switch (histotype) {	
    case "BREAST": return "Breast";// break;	
    case "LUNG": return "Lung";// break;	
    case "HEADNECK": return "Head &amp; Neck";// break;	
    case "OESOPHAGUS": return "Esophagus";// break;	
    case "BONE": return "Osteosarcoma"; // same as below.
    case "OSTEOSARCOMA": return "Osteosarcoma";// break;	
    case "OVARY": return "Ovary";// break;	
    case "ENDOMETRIUM": return "Endometrium";// break;	
    case "PANCREAS": return "Pancreas";// break;	
    case "CERVICAL": return "Cervical";// break;	
    case "CENTRAL_NERVOUS_SYSTEM": return "CNS";// break;	
    case "HAEMATOPOIETIC_AND_LYMPHOID_TISSUE": return "Blood &amp; Lymph";// break;	
    case "INTESTINE": return "Intestine";// break;	
    case "KIDNEY": return "Kidney";// break;	
    case "PROSTATE": return "Prostate";// break;	
    case "SKIN": return "Skin";// break;	
    case "SOFT_TISSUE": return "Soft tissue";// break;	
    case "STOMACH": return "Stomach";// break;	
    case "URINARY_TRACT": return "Urinary tract";// break;	
    case "PANCAN": return "Pan cancer";// break;	
    case "ALL_HISTOTYPES": return "All tissues";// break;
    default: return 'Error: Histotype "'+histotype+'" Not Found';
  }
}

  
var tissue_colours = {
  "BONE":         "yellow",
  "OSTEOSARCOMA": "yellow", // same as BONE above
  "BREAST":       "deeppink",  // Colt only contains Breast
  "LUNG":         "darkgrey",
  "HEADNECK":     "firebrick",  // Not in Achilles data  *** THIS "firebrick4" COLOUR NOT WORKING IN IE SVG
  "PANCREAS":     "purple",
  "CERVICAL":     "blue",  // Not in Achilles data
  "OVARY":        "cadetblue",
  "OESOPHAGUS":   "green",
  "ENDOMETRIUM":  "orange",
  "CENTRAL_NERVOUS_SYSTEM": "darkgoldenrod",  // *** THIS "darkgoldenrod4" COLOUR NOT WORKING IN IE SVG
  "HAEMATOPOIETIC_AND_LYMPHOID_TISSUE": "darkred",  // Not in Campbell
  "INTESTINE":    "saddlebrown",  // Not in Campbell
  "KIDNEY":       "indianred",  // Not in Campbell
  "LIVER":        "slategray",  // Not in Campbell
  "PROSTATE":     "turquoise",  // Not in Campbell
  "SKIN":         "peachpuff",  // Not in Campbell
  "SOFT_TISSUE":  "lightgrey",  // Not in Campbell
  "STOMACH":      "black",  // Not in Campbell
  "URINARY_TRACT":"yellowgreen"  // Not in Campbell
  };
    
//var driver = "SEMG2", target = "CAMK1", wilcox_p = "1.8e-2", effect_size = "0.78", histotype="Pan cancer", study="Campbell(2016)";
// was: "range,-8,2;wt_box,-2.57,-1.15,-0.58,-0.09,1.28;mu_box,-3.01,-3.01,-2.15,-0.62,-0.52;
//var boxplot_csv = "80,-8,2,-2.57,-1.15,-0.58,-0.09,1.28,-3.01,-3.01,-2.15,-0.62,-0.52;BONE,143B,1.25,-1.04,0;BONE,CAL72,1.26,-0.23,0;BONE,HOS,0.95,-1.84,0;BONE,HUO3N1,1.19,-1.2,0;BONE,HUO9,1.11,-0.39,0;BONE,MG63,1.15,-1.13,0;BONE,NOS1,0.79,-0.35,0;BONE,NY,1.01,-0.13,0;BONE,SAOS2,1.09,-1.04,0;BONE,SJSA1,0.94,-0.1,0;BONE,U2OS,0.7,-0.3,0;BONE,G292,2.07,-0.52,1;BREAST,BT20,0.79,-0.39,0;BREAST,BT549,0.86,0.47,0;BREAST,CAL120,0.81,-2.79,0;BREAST,CAL51,0.69,0.24,0;BREAST,CAMA1,0.98,-1.01,0;BREAST,DU4475,0.68,0.53,0;BREAST,HCC1954,0.79,-0.44,0;BREAST,HCC202,1.28,0.18,0;BREAST,HCC38,1.13,0.79,0;BREAST,HCC70,1.17,-0.5,0;BREAST,HS578T,1.07,0.19,0;BREAST,MCF7,1.2,0.47,0;BREAST,MDAMB157,0.88,0.44,0;BREAST,MDAMB231,1.27,-1.71,0;BREAST,MDAMB436,1.25,0.49,0;BREAST,MDAMB453,0.92,-2.02,0;BREAST,MFM223,0.94,-0.6,0;BREAST,T47D,1.32,-0.63,0;BREAST,ZR7530,0.68,-0.03,0;BREAST,BT474,1.98,-2.15,1;BREAST,JIMT1,1.92,-7.38,1;LUNG,A427,1.25,-2.93,0;LUNG,A549,1.19,-3.52,0;LUNG,BEN,0.7,-0.72,0;LUNG,H1299,0.68,-1.67,0;LUNG,H1650,1.26,-1.14,0;LUNG,H1838,1.31,-0.26,0;LUNG,H1975,1.22,-0.22,0;LUNG,H2228,1.11,0.34,0;LUNG,H23,1.14,-0.25,0;LUNG,H2342,1.07,-1.99,0;LUNG,H292,1.28,-1.18,0;LUNG,H358,0.99,-0.87,0;LUNG,H460,1.22,-0.42,0;LUNG,H727,1.22,-1.9,0;LUNG,H1793,1.75,-3.01,1;HEADNECK,PCI30,1.16,-0.58,0;PANCREAS,ASPC1,0.92,-0.47,0;PANCREAS,BXPC3,1.17,-0.62,0;PANCREAS,MIAPACA2,1.02,-3.54,0;CERVICAL,C33A,1.33,-1.83,0;CERVICAL,CASKI,0.78,-0.6,0;CERVICAL,HELA,0.94,-0.83,0;CERVICAL,SIHA,0.79,-1.16,0;OVARY,CAOV3,1.25,1.28,0;OVARY,ES2,1.33,-0.08,0;OVARY,OAW42,1.11,-0.15,0;OVARY,OV90,0.76,-0.83,0;OVARY,OVISE,1.14,-2.46,0;OVARY,OVMANA,1.24,0.9,0;OVARY,OVTOKO,1.2,-0.76,0;OVARY,RMGI,1.24,-0.14,0;OVARY,SKOV3,1.31,-0.38,0;OVARY,TOV112D,1.07,-1.3,0;OVARY,TOV21G,0.8,-1.43,0;OESOPHAGUS,ESO26,1.06,0.78,0;OESOPHAGUS,FLO1,1.32,-1.12,0;OESOPHAGUS,OE19,0.92,-0.38,0;OESOPHAGUS,OE33,1.31,-1.09,0;OESOPHAGUS,SKGT4,1.21,0.9,0;OESOPHAGUS,TE1,0.72,0.02,0;OESOPHAGUS,TE10,1.3,-0.67,0;OESOPHAGUS,TE11,0.81,0.68,0;OESOPHAGUS,TE6,0.99,0.68,0;OESOPHAGUS,TE9,0.68,-5.88,0;OESOPHAGUS,TE8,1.7,-0.62,1;ENDOMETRIUM,MFE296,1.3,-2.57,0;CENTRAL_NERVOUS_SYSTEM,KNS42,1.08,-0.84,0";

var driver = "ERBB2", target="MAP2K3", wilcox_p = "4 x 10<sup>-4</sup>", effect_size = "81%", delta_score="-999.99", histotype="Pan cancer", study="Campbell(2016)";
var boxplot_csv ="79,-5,2,-2.66,-1.28,-0.62,0.04,1.26,-4.61,-3.555,-1.765,-0.91,-0.62;BONE,143B,1.14,-0.21,0;BONE,CAL72,1.1,-0.61,0;BONE,G292,1.01,-1.85,0;BONE,HOS,1.13,-2.15,0;BONE,HUO3N1,0.86,-1.12,0;BONE,HUO9,0.82,-0.91,0;BONE,MG63,0.71,-1.48,0;BONE,NOS1,1.12,-0.99,0;BONE,NY,0.97,0.18,0;BONE,SAOS2,1.16,-0.91,0;BONE,SJSA1,1.11,0.88,0;BONE,U2OS,1.3,0.36,0;BREAST,BT20,1.3,-2.29,0;BREAST,BT549,0.76,-1.67,0;BREAST,CAL120,0.81,1.26,0;BREAST,CAL51,0.69,-0.67,0;BREAST,CAMA1,0.73,1.04,0;BREAST,DU4475,0.9,0.22,0;BREAST,HCC38,0.93,-0.23,0;BREAST,HCC70,0.73,-0.91,0;BREAST,HS578T,0.91,-2.03,0;BREAST,MCF7,1.3,-0.42,0;BREAST,MDAMB157,1.12,-1.54,0;BREAST,MDAMB231,1,-0.1,0;BREAST,MDAMB436,0.74,-0.1,0;BREAST,MFM223,1.09,-1.94,0;BREAST,T47D,1.29,-2.31,0;BREAST,BT474,2.05,-3.45,1;BREAST,HCC1954,1.88,-0.62,1;BREAST,HCC202,1.91,-4.61,1;BREAST,JIMT1,2.17,-1.09,1;BREAST,MDAMB453,1.88,-0.71,1;BREAST,ZR7530,2.27,-3.66,1;LUNG,A427,0.96,-0.31,0;LUNG,A549,0.74,-0.85,0;LUNG,BEN,0.77,-1.27,0;LUNG,H1299,1.29,0.19,0;LUNG,H1650,0.76,0.4,0;LUNG,H1838,0.92,-0.34,0;LUNG,H1975,1.27,-0.52,0;LUNG,H2228,1.29,-0.65,0;LUNG,H23,1.26,-0.55,0;LUNG,H2342,0.8,-2.66,0;LUNG,H292,1.28,-0.54,0;LUNG,H358,0.9,0.46,0;LUNG,H460,1.17,0.19,0;LUNG,H727,1.28,-0.75,0;HEADNECK,PCI30,0.69,-0.08,0;PANCREAS,ASPC1,0.69,-0.4,0;PANCREAS,BXPC3,0.93,-1.26,0;PANCREAS,MIAPACA2,0.82,-0.22,0;CERVICAL,C33A,0.87,-1.29,0;CERVICAL,CASKI,1.08,-1.52,0;CERVICAL,HELA,1.23,-1.02,0;CERVICAL,SIHA,0.86,-1.49,0;OVARY,CAOV3,0.92,0.36,0;OVARY,ES2,1.21,-1.13,0;OVARY,OAW42,1.16,-2.26,0;OVARY,OV90,0.78,-0.3,0;OVARY,OVISE,1.26,-1.67,0;OVARY,OVMANA,0.7,-1.58,0;OVARY,OVTOKO,1.23,-1.32,0;OVARY,TOV112D,1.11,0.53,0;OVARY,TOV21G,1.05,0.23,0;OVARY,RMGI,2.11,-1.55,1;OVARY,SKOV3,1.79,-2.49,1;OESOPHAGUS,FLO1,0.9,-1,0;OESOPHAGUS,SKGT4,0.95,0.61,0;OESOPHAGUS,TE1,1.16,-0.81,0;OESOPHAGUS,TE10,0.85,-0.82,0;OESOPHAGUS,TE11,1.03,0.08,0;OESOPHAGUS,TE8,0.68,-0.62,0;OESOPHAGUS,TE9,1.13,0,0;OESOPHAGUS,ESO26,2.33,-4.29,1;OESOPHAGUS,OE19,1.77,-0.83,1;OESOPHAGUS,OE33,1.7,-1.98,1;OESOPHAGUS,TE6,1.77,-0.99,1;ENDOMETRIUM,MFE296,1.06,0.6,0;CENTRAL_NERVOUS_SYSTEM,KNS42,1.08,0.37,0"

var irange=0, iwtbox=3, imubox=8;
var itissue=0, icelline=1, ix=2, iy=3, imutant=4;
var svgNS="http://www.w3.org/2000/svg"; // Name space needed for SVG.
var YscreenMin=550, YscreenMax=10; // To allow a margin a bottom, and small margin at top
var XscreenMin=50,  XscreenMax=590; // To allow for a margin at left
var wtxc=1.6, muxc=3.8, boxwidth=1.8;
var svg, xscale, yscale, Yscreen0, lines;
var tissue_lists;
    
 $(function() { // on dom ready
  
  lines = boxplot_csv.split(";"); // 'lines' is global as is used by the tooltip on hoover
  var col = lines[0].split(","); // y-axis range and wt & mu boxes
  
  var count = parseInt(col[0]);  // .split(",")[1]
  // The "count" is the number of cell_lines. So add 1 lines for first line(count,range,wt_box,mu_box).
  
  if (lines.length-1 != count) {alert( "Boxplot data length mismatch: "+(lines.length-1)+" != "+count )}

  var ymin = parseInt(col[1]), ymax = parseInt(col[2]);

  // These are global:
  // From: http://www.i-programmer.info/programming/graphics-and-imaging/3254-svg-javascript-and-the-dom.html
  svg=document.getElementById("mysvg"); // or can create with js: var svg=document.createElementNS(svgNS,"svg"); svg.width=300; svg.height=300; document.body.appendChild(svg);  
    
  xscale = 100; 
  yscale = (YscreenMax-YscreenMin)/(ymax-ymin);  // This is -ive, so Yscreen0 = YscreenMin + ymin*yscale
  Yscreen0 = YscreenMin - ymin*yscale;  // is really Yscreen0 = YscreenMin + (y0 - ymin)*yscale; eg. 380+(0-2)*(-30)
 
  axes(wtxc,muxc, ymin,ymax);
  var wt_boxstats = []; for (var i=0; i<5; i++) {wt_boxstats[i] = parseFloat(col[iwtbox+i]);}
  var mu_boxstats = []; for (var i=0; i<5; i++) {mu_boxstats[i] = parseFloat(col[imubox+i]);}
  boxplot( wtxc, boxwidth, wt_boxstats);
  boxplot( muxc, boxwidth, mu_boxstats);
  
  line(XscreenMin/xscale,-2, XscreenMax/xscale,-2, "1px", true, "red"); // the red y=-2 full-width line
	
  beeswarm(lines, wtxc-1*boxwidth, muxc-2*boxwidth, boxwidth); // The -1 and -2 are because that is the position set in R for the jitter.
  
  $("#boxplot_title").html("<b>"+target+"</b> altered cell lines have an increased dependency upon <b>"+driver+"</b><br/>(p="+wilcox_p+" | effect size="+effect_size+" | &Delta;Score="+delta_score+" | Tissues="+histotype + " | Source="+study + ")<br/>WebLinks ......");

    // $('#title').tooltip({
  $( document ).tooltip({
    items: "circle",
    //content: "Awesome title!"
	position: { my: "left+23 center", at: "center center+10" }, // at: "right center" }
	show: false, //{ effect: "", duration: 0, delay: 0},
	hide: false, // { effect: "", duration: 0, delay: 0}, // see: http://webduos.com/tooltip-using-jquery-ui-library/#.Vvb48uKLSih	
	content: function(callback) {
	  var element = $( this );
      if ( element.is( "circle" ) ) {
	    var id = element.attr("id");
        var i = parseInt(id.substring(1)); // remove the starting 'c'
	    var col = lines[i].split(",");  // or could encode the tissue and celline in the ID.
        return '<b>'+col[icelline]+'</b><br/>'+histotype_display(col[itissue])+'<br/>Z-score: '+col[iy];
	    }
	}
  });
 
  }); // on dom ready


function axes(wtxc,muxc, ymin,ymax) {
    line(wtxc, ymin, muxc, ymin, "1px", false, "black"); // the horizontal axis
	line(wtxc, ymin, wtxc, ymin+8/yscale, "1px", false, "black"); // tick mark at 'wt'
	line(muxc, ymin, muxc, ymin+8/yscale, "1px", false, "black"); // tick mark at 'mutant'
    text(wtxc-0.1,ymin+23/yscale,18,false,"wt");
    text(muxc-0.3,ymin+23/yscale,18,false,"mutant");

    text(wtxc+0.5,ymin+45/yscale,20,false,driver+"  status");
	
	line(XscreenMin/xscale, ymin, XscreenMin/xscale, ymax, "1px", false, "black"); // y-axis
	for (var y=ymin; y<=ymax; y++) {
	  line((XscreenMin-5)/xscale,y, XscreenMin/xscale,y,"1px",false,"black")
	  var x = y>=0 ? 0.32 : 0.27;
	  text(x,y+8/yscale,18,false, y.toString());
	  }
		
	text(15/xscale,ymin+2,20,true,target+" Z-score");
    }

function mouseOver(e) {
    //this.setAttribute("r", "10");	
	//alert("In");
	e = e || window.event;  // Need: window.event for IE <=8 
	var target = e.target || e.srcElement;	
	target.setAttribute("r", "10");
	// $('#title').tooltip( "open" );
	//$( document ).tooltip("open");
	//console.log("Here...");
    }

function mouseOut(e) {
    //this.setAttribute("r", "5");
	//alert("Out");	
	e = e || window.event;  // Need: window.event for IE <=8 
	var target = e.target || e.srcElement;	
	target.setAttribute("r", "5");	
    }


function beeswarm(lines,wtx,mux,boxwidth) {
  tissue_lists = {}; // a global variable as used by 'toggle_tissue_checkboxes(e)'
  var wt_tissue_counts = {}, mu_tissue_counts = {};
  for (var i=1; i<lines.length-1; i++) {
    var e = document.createElementNS(svgNS,"circle");
    var col = lines[i].split(",");
    var tissue = col[itissue];
	var colour = tissue_colours[tissue];
	if (typeof colour === 'undefined') {alert("Unexpected tissue '"+tissue+"'");}
	
    e.setAttribute("fill", colour);
    //e.setAttribute("stroke", colour);    // e.style.stroke=colour;
	// e.setAttribute("stroke-width", "1"); // e.style.strokewidth=1;
	// e.setAttribute("fill-opacity", "0.5");
	var xcenter = col[imutant]==0 ? wtx : mux;

	e.setAttribute("cx", ((xcenter + boxwidth*parseFloat(col[ix])) * xscale).toString() ); // or: e.cx.baseVal.value =  parseFloat(col[2]) * xscale );
	e.setAttribute("cy", (Yscreen0 + parseFloat(col[iy]) * yscale).toString() ); // or: e.cy.baseVal.value = parseFloat(col[3]) * yscale );
	e.setAttribute("r", "5"); // Firefox and IE don't use the 'r' in the 'circle' class (whereas Chrome does)  e.r.baseVal.value = "5"; set in the 'circle' class
	var id = "c"+i.toString();
	e.setAttribute("id", id); // 'c' for circle or cell_line

    if (tissue in tissue_lists) {tissue_lists[tissue].push(e);}
	else {
	  tissue_lists[tissue]=[e];
	  wt_tissue_counts[tissue]=0;
	  mu_tissue_counts[tissue]=0;
	  }
	if (col[imutant]==0) {wt_tissue_counts[tissue]++}  // This is correctly outside the above
	else {mu_tissue_counts[tissue]++}
	
	//e.setAttribute("onmouseover", "mouseOver();");
    //e.setAttribute("onmouseout", "mouseOut();"); // ="evt.target.setAttribute('opacity','1)');"/>
	e.onmouseover = mouseOver;  // or: e.onmouseover = function() { myFun(this) };
	// the mouseenter event, the mouseover event triggers if a mouse pointer enters any child elements as well as the selected element. The mouseenter event is only triggered when the mouse pointer enters the selected element. 
	e.onmouseout = mouseOut;
	
	//evt.target.setAttribute('opacity', '0.5');"
	svg.appendChild(e);
	//console.log(i,((xcenter + parseFloat(col[ix])) * xscale).toString(),(Yscreen0 + parseFloat(col[iy]) * yscale).toString());
    }
	
    var toggle_button = '<input input type="button" id="toggle_checkboxes" value="Toggle" style="font-size: 90%" onclick="toggle_tissue_checkboxes();">';
	var legend = "<tr><th>Show<br/>"+toggle_button+"</th><th>Tissue</th><th>Total<br/>cellines</th><th>WildType<br/>cellines</th><th>Mutant<br/>cellines</th></tr>";
    for (tissue in tissue_lists) {
	  var colour = tissue_colours[tissue];
//	  legend += '<tr><td id="td_'+tissue+'" style="text-align:center" bgcolor="'+colour+'" onclick="showhide_cell_clicked(this);"><input type="checkbox" id="cb_'+tissue+'" checked onchange="showhide_tissue(this);" /></td><td>'+histotype_display(tissue)+'</td><td style="text-align:center">'+tissue_lists[tissue].length+'</td></tr>';
      if (tissue_lists[tissue].length != wt_tissue_counts[tissue]+mu_tissue_counts[tissue]) {alert("ERROR: Tissue count mismatch for tissue: '"+tissue+"'")} // Just to check my script is working correctly
	  
	  if (wt_tissue_counts[tissue]==0) {wt_tissue_counts[tissue]='<i>'+wt_tissue_counts[tissue].toString()+'</i>'} // To put italics on the zeros
	  if (mu_tissue_counts[tissue]==0) {mu_tissue_counts[tissue]='<i>'+mu_tissue_counts[tissue].toString()+'</i>'}
	  legend += '<tr><td id="td_'+tissue+'" style="text-align:center" bgcolor="'+colour+'"><input type="checkbox" id="cb_'+tissue+'" checked/></td><td>'+histotype_display(tissue)+'</td><td style="text-align:center">'+tissue_lists[tissue].length+'</td><td style="text-align:center">'+wt_tissue_counts[tissue]+'</td><td style="text-align:center">'+mu_tissue_counts[tissue]+'</td></tr>';
	  	  
	  // The onchange event should also work with keyboard input, whereas onclick is only mouse clicks I think.
	  }
	  
	$("#legend_table").html(legend);
	
	// The inline onchange="..." tag doesn't pass the event in all browsers, which is needed, so attaching the events using javascript:
    for (tissue in tissue_lists) {
		showhide_cell_clicked
		document.getElementById("td_"+tissue).onclick=showhide_cell_clicked;
		document.getElementById("cb_"+tissue).onchange=showhide_tissue;
		}		
}


function rect(xcenter,width,ystats) {
    var e = document.createElementNS(svgNS,"rect");
	e.setAttribute("x", (xcenter-0.5*width)*xscale );
    e.setAttribute("width", width*xscale );
	e.setAttribute("y", Yscreen0 + ystats[3]*yscale );  // Note: box drawn upside down, as screen zero is top left.
	e.setAttribute("height", (ystats[1]-ystats[3])*yscale );	// yscale is -ive
	//e.setAttribute("fill", "none"); // set by the CSS
	//e.setAttribute("stroke", "black");
	//e.setAttribute("stroke-opacity", "1.0");
	//e.setAttribute("stroke-width", strokewidth);
    svg.appendChild(e); // or: document.documentElement.appendChild(elem);
	}
	
function line(x1,y1,x2,y2,strokewidth,dashed,colour) {
    var e = document.createElementNS(svgNS,"line");
	e.setAttribute("x1", x1*xscale );  // For sharp lines, best to have position at 0.5 if thinkness is 1px, then won't need antialiasing.
	e.setAttribute("y1", Yscreen0 + y1*yscale );
	e.setAttribute("x2", x2*xscale );
	e.setAttribute("y2", Yscreen0 + y2*yscale );
	e.setAttribute("stroke", colour); // as black is default in the CSS
	e.setAttribute("stroke-width", strokewidth);
	if (dashed) {e.setAttribute("stroke-dasharray", "6,3");} // se: http://www.w3schools.com/svg/svg_stroking.asp
    svg.appendChild(e);
	}

function cline(xcenter,width,ystats) {
// <canvas id="myCanvas" width="200" height="100"></canvas>  // Optionally: style="border:1px solid #000000;"
// can translate the 0,0 position, eg: ctx.translate(radius, radius);
//var c = document.getElementById("myCanvas");
//var ctx = c.getContext("2d");
    // ctx.fillStyle = "#FF0000";
    ctx.fillRect(0,0,150,75);
    }
	
function cline(x1,y1,x2,y2) {
// Drawing on HTML 5 Canvas:
// var c = document.getElementById("myCanvas");
// var ctx = c.getContext("2d");
    ctx.moveTo(x1,y1);
    ctx.lineTo(x2,y2);
    ctx.stroke(); // This actually draws the line.
	}
	
function circle() {	
	ctx.beginPath();
ctx.arc(95,50,40,0, 2*Math.PI); // arc(x,y,r,startangle,endangle) - creates an arc/curve. To create a circle with arc(): Set start angle to 0 and end angle to 2*Math.PI. The x and y parameters define the x- and y-coordinates of the center of the circle. The r parameter defines the radius of the circle.
ctx.stroke();
or for filled circle:
ctx.fillStyle = "white";
ctx.fill();
	}
	
function ctext() {
	ctx.font = "30px Arial";
ctx.fillText("Hello World",10,50);
// or:
ctx.font = "30px Comic Sans MS";
ctx.fillStyle = "red";
ctx.textAlign = "center";
ctx.fillText("Hello World", canvas.width/2, canvas.height/2); 
or:
ctx.font = radius*0.15 + "px arial";
ctx.textBaseline="middle";
ctx.textAlign="center";
	}
	
function text(x,y,size,vertical,text) {
    // Fore attributes, see: http://www.w3schools.com/svg/svg_text.asp
    var e = document.createElementNS(svgNS,"text");
    var xscreen = x*xscale;
	e.setAttribute("x", xscreen);
	var yscreen = Yscreen0 + y*yscale;
	e.setAttribute("y", yscreen);
	e.setAttribute("font-size", size);
	if (vertical) {e.setAttribute("transform", "rotate(-90,"+xscreen+","+yscreen+")");}  // transform="rotate(30 20,40)" See: http://stackoverflow.com/questions/11252753/rotate-x-axis-text-in-d3
	//e.setAttributeNS(null,"stroke", colour);
    e.appendChild(document.createTextNode(text));
    svg.appendChild(e);
	}

	
function boxplot(xcenter,width,ystats) {
    rect(xcenter,width,ystats);
	line(xcenter-0.25*width,ystats[0], xcenter+0.25*width,ystats[0], "1px", false, "black"); // lower whisker horizontal line
	line(xcenter,ystats[0], xcenter,ystats[1], "1px", true, "black");  // lower whisker to box dashed line
	line(xcenter-0.5*width,ystats[2], xcenter+0.5*width,ystats[2], "3px", false, "black"); // median horizontal line
	line(xcenter,ystats[3], xcenter,ystats[4], "1px", true, "black");  // upper whisker to box dashed line
	line(xcenter-0.25*width,ystats[4], xcenter+0.25*width,ystats[4], "1px", false, "black"); // upper whisker horizontal line
    }	


function showhide_cell_clicked(e) {  // elem can be a 'td' or checkbox.
// When the checkbox is clicked: IE seems to call this checkbox code first then the 'td' click event, whereas Chrome and Firefox seem to call the 'td' event first, then the checkbox event.
    // Not using event as not passed in Firefox when inline onclick="" used
	e = e || window.event;  // Need: window.event for IE <=8
	//e.preventDefault(); // should cancel the also click cell event
//	e.stopPropagation(); // To stop propagation to parent element. ie. stops the event from bubbling up the event chain.
// see: http://stackoverflow.com/questions/5963669/whats-the-difference-between-event-stoppropagation-and-event-preventdefault
//e.cancelBubble  // for IE<=8 
//or maybe use jquery e.stopPropagation...

	var elem = e.target || e.srcElement;
//console.log('showhide_cell: '+elem.id);
    if (elem.id.substring(0,3)=='cb_') {
//	     console.log('leaving showhide_cell');
	    return true; // Need to return true so will be handled by the checkbox click event (showhide_tissue(e)).
	}
	var tissue = elem.id; /// the checkbox name is the tissue.
//	console.log(tissue);
    tissue=tissue.substring(3); // remove the 'td_'
//console.log(tissue);
	//window.event.preventDefault(); // should cancel the also click cell event
   	var checkbox = document.getElementById('cb_'+tissue);
	// checkbox.click();
	checkbox.checked = ! checkbox.checked; // Toggle checked state, but doesn't fire the onchanged event.
	set_tissue_visibility(tissue, checkbox.checked)
    // checkbox.dispatchEvent(new Event('change')); // so need to trigger the change event.	
// [1]: Earlier versions of IE instead only support the proprietary EventTarget.fireEvent() method.
    return false;
    }


function set_tissue_visibility(tissue,visibile) {
	for (var i=0; i<tissue_lists[tissue].length; i++) {
	    var elem = tissue_lists[tissue][i];
	    elem.setAttribute("visibility", visibile ? "visible":"hidden");
	    }
	}

	
function showhide_tissue(e) {
    // see: http://stackoverflow.com/questions/24578837/remove-or-hide-svg-element

	e = e || window.event;  // Need: window.event for IE <=8
	//e.preventDefault(); // should cancel the also click cell event
//	e.stopPropagation(); // To stop propagation to parent element. ie. stops the event from bubbling up the event chain.
//e.cancelBubble  // for IE<=8 
//or maybe use jquery e.stopPropagation...

//if (!e) e = window.event;
//    e.cancelBubble = true;
//    if (e.stopPropagation) e.stopPropagation();
//}

	var checkbox = e.target || e.srcElement;
//console.log('checkbox '+checkbox.id);
	var tissue = checkbox.id.substring(3); /// the checkbox name is the 'cb_'+tissue.

	set_tissue_visibility(tissue, checkbox.checked);
	return false; // does true mean event was handled?
    }
   
function toggle_tissue_checkboxes(e) {
	//e = e || window.event;  // Need: window.event for IE <=8
	//var checkbox = e.target || e.srcElement;   
    //var visibility = checkbox.checked ? "visible" : "hidden";
    for (tissue in tissue_lists) {
   	  var checkbox = document.getElementById('cb_'+tissue);
	  
	  checkbox.checked = ! checkbox.checked; // Toggle checked state, but doesn't fire the onchanged event.
	  set_tissue_visibility(tissue, checkbox.checked);
		
      //checkbox.dispatchEvent(new Event('change')); // so need to trigger the change event.
	  
	  // BUT this may not fire the changed event: To make sure the event fires, call the click() method of the checkbox element, like this:  document.getElementById('checkbox').click();
	  
//However, this toggles the checked status of the checkbox, instead of specifically setting it to true or false. Remember that the //change event should only fire, when the checked attribute actually changes.
// It also applies to the jQuery way: setting the attribute using prop or attr, does not fire the change event.
// http://stackoverflow.com/questions/8206565/check-uncheck-checkbox-with-javascript

      }
    }
   
function save_svg_as_png() {
   // Uses the "saveSvgAsPng.js" from: https://github.com/exupero/saveSvgAsPng
   var study_without_brackets = study.replace('(','').replace(')','');
   var png_filename = driver+"_"+target+"_"+study_without_brackets+".png";
   saveSvgAsPng(svg, png_filename);
   }
   
  </script>

</head>

<body>
<br/>
<table align="center"><tr><td>
<!-- the tag: version="1.1" isn't used by any browsers -->
<svg id="mysvg" 
	 xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink" 
     width="600" height="600">
  <style>
    line{
      /* stroke: black; */
      /* stroke-width: 1px; */
      stroke-opacity: 1.0;	
	  shape-rendering: crispEdges;	
	}
	
    rect{
      fill: none;
      stroke: black;
      stroke-width: 1px;
      stroke-opacity: 1.0;
	  shape-rendering: crispEdges;
    }
	
    circle {
	  /* r: 5; */
      fill-opacity: 0.9;
      stroke-width: 1px;
/*      fill: #3080d0; */
      stroke: black;
	  /* shape-rendering: crispEdges; */
    }

	circle:hover
    {
      opacity: 0.9;
	  stroke: black;
      /* fill: blue; */
	  /* r: 10; */
    }
	/* As 'r' is not a style, an alternative way is to make the stroke-width bigger on hoover. http://stackoverflow.com/questions/14255631/style-svg-circle-with-css 

	stroke-width:10px;	
	*/
	
	text {
	  font-family: sans-serif;
	}
  </style>
  <!--circle id="my-circle" cx="100" cy="100" r="50" /-->
  <!-- polyline points="20,20 380,20 380,380 20,380 20,20" style="fill:none;stroke:black;stroke-width:2" /-->
  <!-- rect x="50" y="10" width="349" height="340" stroke="yellow" fill="none" stroke-width="2" /-->
   Sorry, your browser does not support inline SVG.
</svg>
</td><td valign="middle">
  <table id="legend_table" cellpadding="1" cellspacing="0" style="font-size: 75%;"></table>
  <p style="font-size:90%">Download boxplot as:<br/><input type="button" id="download_SVG_boxplot" value="SVG image"/> <input type="button" id="download_PNG_boxplot" value="PNG image" onclick="save_svg_as_png();"/> <input type="button" id="download_CSV_boxplot" value="CSV data"/>
</td></tr>
<tr><td id="boxplot_title" colspan="2" style="text-align:center"></td></tr>
</table>
</body>
</html>




